apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: immich-postgresql
spec:
  bootstrap:
    initdb:
      database: immich
      encoding: UTF8
      localeCType: C
      localeCollate: C
      owner: immich
  instances: 3
  storage:
    size: 10Gi
  monitoring:
    customQueriesConfigMap:
      - key: create-extensions.sql
        name: immich-postgresql-init-scripts
  postgresql:
    parameters:
      max_connections: "200"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: immich-postgresql-init-scripts
data:
  create-extensions.sql: |
    CREATE EXTENSION cube;
    CREATE EXTENSION earthdistance;
    CREATE EXTENSION vectors;
