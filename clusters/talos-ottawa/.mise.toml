[tools]
task = "3"
talhelper = "latest"
talosctl = "latest"
sops = "latest"
kubectl = "latest"
helmfile = "latest"

[env]
KUBECONFIG = "{{config_root}}/kubeconfig"
TALOSCONFIG = "{{config_root}}/bootstrap/talos/clusterconfig/talosconfig"
# Using PGP instead of Age - key should be in GPG keyring

[tasks.init]
run = "task -d bootstrap/talos init"
description = "Initialize Talos secrets (generates and encrypts talsecret.sops.yaml)"

[tasks.bootstrap]
run = "task -d bootstrap/talos bootstrap"
description = "Bootstrap the Talos cluster"

[tasks.genconfig]
run = "task -d bootstrap/talos genconfig"
description = "Generate Talos configuration"

[tasks.apply]
run = "task -d bootstrap/talos apply"
description = "Apply Talos configuration to nodes"

[tasks.apply-insecure]
run = "task -d bootstrap/talos apply-insecure"
description = "Apply Talos configuration to nodes in maintenance mode (initial install)"

[tasks.kubeconfig]
run = "task -d bootstrap/talos kubeconfig"
description = "Fetch kubeconfig from cluster"

[tasks.health]
run = "task -d bootstrap/talos health"
description = "Check cluster health"

[tasks.dashboard]
run = "task -d bootstrap/talos dashboard"
description = "Open Talos dashboard"

[tasks.test-thunderbolt]
run = "task -d bootstrap/talos test-thunderbolt"
description = "Test Thunderbolt connectivity"

[tasks.deploy-thunderbolt-debug]
run = "task -d bootstrap/talos deploy-thunderbolt-debug"
description = "Deploy privileged DaemonSet for Thunderbolt debugging"

[tasks.reset]
run = "task -d bootstrap/talos reset"
description = "Reset cluster (DESTRUCTIVE)"

[tasks.cleanup-thunderbolt-debug]
run = "task -d bootstrap/talos cleanup-thunderbolt-debug"
description = "Remove Thunderbolt debug DaemonSet"