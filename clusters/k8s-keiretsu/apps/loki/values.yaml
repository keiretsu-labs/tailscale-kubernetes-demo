fullnameOverride: loki

loki:
  schemaConfig:
    configs:
      - from: 2022-09-03
        store: boltdb-shipper
        object_store: s3
        schema: v11
        index:
          prefix: loki_index_
          period: 24h

  storageConfig:
    boltdb_shipper:
      shared_store: s3
      active_index_directory: /var/loki/index
      cache_location: /var/loki/cache
      cache_ttl: 168h
    aws:
      s3: s3://us-east-2/df-hubble-demo-ce-01-grafana-loki
      region: us-east-2
      s3forcepathstyle: true

  structuredConfig:
    server:
      http_server_read_timeout: 2m
      http_server_write_timeout: 2m
      grpc_server_max_recv_msg_size: 8388608
      grpc_server_max_send_msg_size: 8388608
    chunk_store_config:
      chunk_cache_config:
        memcached_client:
          timeout: 500ms

gateway:
  nginxConfig:
    serverSnippet: |
      proxy_read_timeout 300;
      proxy_send_timeout 300;
  resources:
    requests:
      cpu: 200m
      memory: 128Mi
    limits:
      memory: 128Mi

distributor:
  extraEnv: &extraEnv
    - name: HOST_IP
      valueFrom:
        fieldRef:
          fieldPath: status.hostIP
    # - name: JAEGER_AGENT_HOST
    #   value: "$(HOST_IP)"
    # - name: JAEGER_SAMPLER_TYPE
    #   value: "const"
    # - name: JAEGER_SAMPLER_PARAM
    #   value: "1"
  resources:
    requests:
      cpu: 500m
      memory: 128Mi
    limits:
      memory: 128Mi

ingester:
  persistence:
    enabled: true
    claims:
      - name: data
        size: 10Gi
        storageClass: rook-cephfs
  extraEnv: *extraEnv
  resources:
    requests:
      cpu: 1
      memory: 6Gi
    limits:
      memory: 6Gi

querier:
  replicas: 2
  maxUnavailable: 1
  persistence:
    enabled: true
    storageClass: rook-cephfs
  extraEnv: *extraEnv
  resources:
    requests:
      cpu: 1
      memory: 12Gi
    limits:
      memory: 12Gi

queryFrontend:
  extraEnv: *extraEnv
  resources:
    requests:
      cpu: 100m
      memory: 512Mi
    limits:
      memory: 512Mi

compactor:
  enabled: true
  persistence:
    enabled: true
    storageClass: rook-cephfs
  extraEnv: *extraEnv
  resources:
    requests:
      cpu: 200m
      memory: 128Mi
    limits:
      memory: 128Mi

serviceMonitor:
  enabled: true

memcachedExporter:
  enabled: true

memcachedFrontend:
  enabled: true
  replicas: 1
  extraArgs:
    - -m 2048
    - -I 32m
  resources:
    requests:
      cpu: 500m
      memory: 3Gi
    limits:
      memory: 3Gi

memcachedChunks:
  enabled: true
  replicas: 2
  maxUnavailable: 1
  extraArgs:
    - -m 2048
    - -I 32m
  resources:
    requests:
      cpu: 500m
      memory: 3Gi
    limits:
      memory: 3Gi
