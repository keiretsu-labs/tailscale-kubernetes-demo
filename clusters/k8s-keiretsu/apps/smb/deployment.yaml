apiVersion: apps/v1
kind: Deployment
metadata:
  name: smb-server
spec:
  replicas: 1
  selector:
    matchLabels:
      app: smb-server
  template:
    metadata:
      name: smb-server
      labels:
        app: smb-server
    spec:
      volumes:
        - name: samba-volume
          persistentVolumeClaim:
            claimName: samba-storage
        - name: nfs-proxmox-vault
          nfs:
            path: /vault/k8s
            server: 192.168.50.104
      containers:
        - name: smb-server
          image: dperson/samba
          env:
            - name: USER
              valueFrom:
                secretKeyRef:
                  name: smb-credentials
                  key: user  # The 'user' key in the secret
            - name: PASSWORD
              valueFrom:
                secretKeyRef:
                  name: smb-credentials
                  key: password  # The 'password' key in the secret
            - name: SHARE
              value: share;/smbshare/;yes;no;no;all;none
          volumeMounts:
            - name: samba-volume
              mountPath: /config
            - name: nfs-proxmox-vault
              mountPath: /mnt/proxmox-vault
          ports:
            - containerPort: 445